var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,f,e){b instanceof String&&(b=String(b));for(var g=b.length,a=0;a<g;a++){var c=b[a];if(f.call(e,c,a,b))return{i:a,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,f,e){b!=Array.prototype&&b!=Object.prototype&&(b[f]=e.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,f,e,g){if(f){e=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var a=b[g];a in e||(e[a]={});e=e[a]}b=b[b.length-1];g=e[b];f=f(g);f!=g&&null!=f&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,e){return $jscomp.findInternal(this,b,e).v}},"es6","es3");
!function(b,f,e,g){XF.EditorManager=XF.Element.newHandler({options:{dragListClass:".js-dragList",commandTrayClass:".js-dragList-commandTray"},$lists:null,trayElements:[],listElements:[],isScrollable:!0,dragula:null,$cache:null,xfEditor:null,init:function(){this.$lists=this.$target.find(this.options.dragListClass);this.$lists.each(XF.proxy(this,"prepareList"));this.$cache=this.$target.find(".js-dragListValue");this.initDragula();var a=XF.Element.getHandler(b("textarea[name=button_layout_preview_html]").first(),
"editor");a?(this.xfEditor=a,a.$target.on("editor:init",XF.proxy(this,"rebuildValueCache"))):this.rebuildValueCache()},prepareList:function(a,c){if(b(c).is(this.options.commandTrayClass))this.trayElements.push(c);else{this.listElements[this.listElements.length]=c;var d=this;a=this.getListId(c);this.getListOptions(a).on("change",function(){d.updateList(c,!0)})}this.updateList(c)},initDragula:function(){var a=this;e.addEventListener("touchmove",function(b){a.isScrollable||b.preventDefault()},{passive:!1});
var c=this.listElements,d;for(d in this.trayElements)c.unshift(this.trayElements[d]);this.dragula=dragula(c,{direction:"horizontal",removeOnSpill:!0,copy:function(b,c){return a.isTrayElement(c)},accepts:function(b,c){return!a.isTrayElement(c)},moves:function(a,c,d,e){return!b(a).hasClass("toolbar-addDropdown")&&!b(a).hasClass("fr-separator")}});this.dragula.on("drag",XF.proxy(this,"drag"));this.dragula.on("dragend",XF.proxy(this,"dragend"));this.dragula.on("drop",XF.proxy(this,"drop"));this.dragula.on("cancel",
XF.proxy(this,"cancel"));this.dragula.on("remove",XF.proxy(this,"remove"));this.dragula.on("over",XF.proxy(this,"over"));this.dragula.on("out",XF.proxy(this,"out"))},drag:function(a,c){this.isScrollable=!1;a=b(a);c=b(c);a.hasClass("toolbar-separator")&&!c.hasClass("js-dragList-commandTray")&&a.next(".fr-separator").remove()},dragend:function(a){this.isScrollable=!0;b(".js-dropTarget").remove()},drop:function(a,c,d,e){a=b(a);b(c);a.data("cmd");a.hasClass("toolbar-separator")?this.appendSeparator(a):
a.next().is(".fr-separator")&&a.insertAfter(a.next());"menu"===a.attr("data-xf-click")&&a.attr("data-xf-click",null);this.isTrayElement(d)||this.updateList(d);this.isTrayElement(c)||this.updateList(c);this.rebuildValueCache()},cancel:function(a,c,d){a=b(a);d=b(d);a.hasClass("toolbar-separator")&&!d.hasClass("js-dragList-commandTray")&&this.appendSeparator(a)},remove:function(a,b,d){this.isTrayElement(d)||(XF.flashMessage(XF.phrase("button_removed"),1500),this.updateList(d,!0))},over:function(a,b,
d){},out:function(a,b,d){},getListId:function(a){return a.id.substr(12)},getListOptions:function(a){return b("#js-toolbar-menu--"+a).find("input, select")},getListOptionValues:function(a){var c={buttons:[]};this.getListOptions(a).each(function(a,e){c[e.name]=b(e).val()});return c},updateList:function(a,c){var d=this.getListId(a);d=this.getListOptionValues(d);b(a).removeClass(function(a,b){return(b.match(/toolbar-option--[^\s$]+/g)||[]).join(" ")}).addClass("toolbar-option--buttonsVisible-"+d.buttonsVisible).addClass("toolbar-option--align-"+
d.align);c&&this.rebuildValueCache()},rebuildValueCache:function(a){var c={},d=this;this.$cache.length&&(this.$lists.not(this.options.commandTrayClass).each(function(a,e){a=d.getListId(e);var f=d.getListOptionValues(a);b(e).children().each(function(a,c){a=b(c);a.data("cmd")&&f.buttons.push(a.data("cmd"))});c[a]=f}),this.$cache.val(JSON.stringify(c)),a&&"editor:init"===a.type||this.updateEditorPreview(c))},updateEditorPreview:function(a){var c=this.xfEditor,d=b(".js-editorToolbars").first();if(c&&
d.length)if(d.html(JSON.stringify({toolbarButtons:a})),c.ed.$tb.hasClass("fr-toolbar-open")){var e=c.ed.$tb.find(".fr-btn.fr-open").first().data("cmd");c.reInit({afterInit:function(){c.ed.commands[e]()}})}else c.reInit()},appendSeparator:function(a){b("<div />").addClass("fr-separator").addClass("fr"+a.data("cmd")).insertAfter(a)},isTrayElement:function(a){return-1!==this.trayElements.indexOf(a)}});XF.Element.register("editor-manager","XF.EditorManager")}(jQuery,window,document);
