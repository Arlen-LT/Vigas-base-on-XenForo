var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,k,p){e instanceof String&&(e=String(e));for(var u=e.length,b=0;b<u;b++){var a=e[b];if(k.call(p,a,b,e))return{i:b,v:a}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,k,p){e!=Array.prototype&&e!=Object.prototype&&(e[k]=p.value)};
$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,k,p,u){if(k){p=$jscomp.global;e=e.split(".");for(u=0;u<e.length-1;u++){var b=e[u];b in p||(p[b]={});p=p[b]}e=e[e.length-1];u=p[e];k=k(u);k!=u&&null!=k&&$jscomp.defineProperty(p,e,{configurable:!0,writable:!0,value:k})}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,p){return $jscomp.findInternal(this,e,p).v}},"es6","es3");
!function(e,k,p,u){e.FE=FroalaEditor;XF.isEditorEnabled=function(){return XF.LocalStorage.get("editorDisabled")?!1:!0};XF.setIsEditorEnabled=function(b){b?XF.LocalStorage.remove("editorDisabled"):XF.LocalStorage.set("editorDisabled","1",!0)};XF.Editor=XF.Element.newHandler({options:{maxHeight:.7,minHeight:250,buttonsRemove:"",attachmentTarget:!0,deferred:!1,attachmentUploader:".js-attachmentUpload",attachmentContextInput:"attachment_hash_combined"},edMinHeight:63,$form:null,buttonManager:null,ed:null,
mentioner:null,emojiCompleter:null,uploadUrl:null,init:function(){this.$target.is("textarea")?(this.options.minHeight=Math.max(this.edMinHeight,this.options.minHeight),this.$target.trigger("editor:start",[this]),this.$form=this.$target.closest("form"),this.$form.length||(this.$form=null),this.options.attachmentTarget&&(this.uploadUrl=this.$target.closest("[data-xf-init~=attachment-manager]").find(this.options.attachmentUploader).attr("href")),this.options.deferred||this.startInit()):console.error("Editor can only be initialized on a textarea")},
startInit:function(b){var a=this,d=b&&b.beforeInit,c=b&&b.afterInit;this.$target.css("visibility","");this.ed=new FroalaEditor(this.$target[0],this.getEditorConfig(),function(){var b=a.ed;d&&d(a,b);a.editorInit();c&&c(a,b)})},reInit:function(b){this.ed&&(this.ed.destroy(),this.startInit(b))},getEditorConfig:function(){var b=this.getHeightLimits(),a="font_awesome_5";"s"!==XF.config.fontAwesomeWeight&&(a+=XF.config.fontAwesomeWeight);b={attribution:!1,direction:FroalaEditor.LANGUAGE.xf.direction,editorClass:"bbWrapper",
fileUpload:!1,fileMaxSize:4294967296,fileUploadParam:"upload",fileUploadURL:!1,fontFamily:{arial:"Arial","'book antiqua'":"Book Antiqua","'courier new'":"Courier New",georgia:"Georgia",tahoma:"Tahoma","'times new roman'":"Times New Roman","'trebuchet ms'":"Trebuchet MS",verdana:"Verdana"},fontSize:"9 10 12 15 18 22 26".split(" "),heightMin:b[0],heightMax:b[1],htmlAllowedTags:"a audio b bdi bdo blockquote br cite code dfn div em h1 h2 h3 h4 h5 h6 hr i img li mark ol p pre s small span strike strong sub sup table tbody td tfoot th thead time tr u ul var video wbr".split(" "),
key:"ZOD3gA8B10A6C5A2G3C-8TMIBDIa1NTMNZFFPFZc1d1Ib2a1E1fA4A3G3F3F2B6C4C4C3G3==",htmlAllowComments:!1,iconsTemplate:a,imageUpload:!1,imageCORSProxy:null,imageDefaultDisplay:"inline",imageDefaultWidth:0,imageEditButtons:"imageAlign imageSize imageAlt | imageReplace imageRemove | imageLink linkOpen linkEdit linkRemove".split(" "),imageManagerLoadURL:!1,imageMaxSize:4294967296,imagePaste:!1,imageResize:!0,imageUploadParam:"upload",imageUploadRemoteUrls:!1,imageUploadURL:!1,language:"xf",linkAlwaysBlank:!0,
linkEditButtons:["linkOpen","linkEdit","linkRemove"],linkInsertButtons:["linkBack"],listAdvancedTypes:!1,paragraphFormat:{N:"Normal",H2:"Heading 1",H3:"Heading 2",H4:"Heading 3"},placeholderText:"",tableResizer:!1,tableEditButtons:["tableHeader","tableRemove","|","tableRows","tableColumns"],toolbarSticky:!1,toolbarStickyOffset:36,videoAllowedTypes:["mp4","quicktime","ogg","webm"],videoAllowedProviders:[],videoDefaultAlign:"center",videoDefaultDisplay:"inline",videoDefaultWidth:500,videoEditButtons:["videoReplace",
"videoRemove","|","videoAlign","videoSize"],videoInsertButtons:["videoBack","|","videoUpload"],videoMaxSize:4294967296,videoMove:!0,videoUpload:!1,videoUploadParam:"upload",videoUploadURL:!1,zIndex:XF.getElEffectiveZIndex(this.$target)+1,xfBbCodeAttachmentContextInput:this.options.attachmentContextInput};FroalaEditor.DefineIcon("insertVideo",{FA5NAME:"video-plus"});this.uploadUrl?(a={_xfToken:XF.config.csrf,_xfResponseType:"json",_xfWithData:1},b.fileUpload=!0,b.fileUploadParams=a,b.fileUploadURL=
this.uploadUrl,b.imageUpload=!0,b.imageUploadParams=a,b.imageUploadURL=this.uploadUrl,b.imagePaste=!0,b.videoUpload=!0,b.videoUploadParams=a,b.videoUploadURL=this.uploadUrl):b.imageInsertButtons=["imageByURL"];a=this.getButtonConfig();b=e.extend({},b,a);this.$target.trigger("editor:config",[b,this]);return b},getButtonConfig:function(){try{var b=e.parseJSON(e(".js-editorToolbars").first().html())||{}}catch(f){console.error("Editor buttons data not valid: ",f);return}var a={};try{var d=e.parseJSON(e(".js-editorDropdowns").first().html())||
{},c;for(c in d)d.hasOwnProperty(c)&&d[c].buttons&&(a[c]=d[c].buttons)}catch(f){console.error("Editor dropdowns data not valid: ",f)}this.buttonManager=b=new XF.EditorButtons(this,b,a);XF.isElementWithinDraftForm(this.$target)||b.addRemovedButton("xfDraft");(a=this.getAttachmentManager())&&a.supportsVideoAudioUploads||b.addRemovedButton("insertVideo");this.options.buttonsRemove&&b.addRemovedButtons(this.options.buttonsRemove.split(","));this.$target.trigger("editor:toolbar-buttons",[{buttonManager:b},
this]);return b.getToolbars()},editorInit:function(){var b=this,a=this.ed;this.watchEditorHeight();if(this.$form&&(this.$form.on("ajax-submit:before draft:beforesync",function(){XF.EditorHelpers.sync(a)}),this.$form.on("draft:complete",function(b,c){if(a.$tb.length&&!0===c.draft.saved&&(b=a.$tb.find(".fr-command.fr-btn[data-cmd=xfDraft]"),b.length)){var f=b.find(".editorDraftIndicator");f.length||(f=e('<b class="editorDraftIndicator" />').appendTo(b));setTimeout(function(){f.addClass("is-active")},
50);setTimeout(function(){f.removeClass("is-active")},2500)}}),this.$form.on("ajax-submit:before",function(b,c){0<a.$el.find(".fr-uploading").length&&!confirm(XF.phrase("files_being_uploaded_are_you_sure"))&&(c.preventSubmit=!0)}),a.events.on("keydown",function(a){if("Enter"==a.key&&(XF.isMac()?a.metaKey:a.ctrlKey))return a.preventDefault(),b.$form.submit(),!1},!0),XF.isElementWithinDraftForm(this.$form))){var d=e(a.$el[0]);XF.Element.applyHandler(d,"draft-trigger")}a.events.on("image.inserted",function(a){a.removeClass("fr-dib").addClass("fr-dii")});
a.events.on("image.loaded",function(a){b.replaceBase64ImageWithUpload(a)});a.events.on("image.beforePasteUpload",function(a){if("data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="==a.src)return!1});var c=!1;a.events.on("cut copy",function(b){if((b=a.selection.ranges(0))&&b.commonAncestorContainer){var c=b.commonAncestorContainer;if(c.nodeType==Node.TEXT_NODE)if(0==b.startOffset&&b.endOffset==c.length&&c.parentNode!=a.$el[0]){for(c=c.parentNode;c.parentNode!=a.$el[0]&&!c.previousSibling&&
!c.nextSibling;)c=c.parentNode;b.selectNode(c)}else c=c.parentNode;var d=e(c).find("p");d.attr("data-xf-p","1");setTimeout(function(){d.removeAttr("data-xf-p")},0)}});a.events.on("paste.before",function(b){c=!1;if(b&&b.clipboardData&&b.clipboardData.getData){var d="";b=b.clipboardData.types;if(a.helpers.isArray(b))for(var f=0;f<b.length;f++)d+=b[f]+";";else d=b;!/text\/plain/.test(d)||a.browser.mozilla||/text\/html/.test(d)||/text\/rtf/.test(d)&&a.browser.safari||(c=!0)}});a.events.on("paste.beforeCleanup",
function(a){c&&(a=a.replace(/\t/g,"    ").replace(/  /g,"&nbsp; ").replace(/  /g,"&nbsp; ").replace(/> /g,">&nbsp;"));a=a.replace(/(<pre[^>]*>)([\s\S]+?)(<\/pre>)/g,function(a,b,c,d){c=c.replace(/\r?\n/g,"<br>");return b+c+d});a=a.replace(/<p([^>]+)margin-top:\s*0[a-z]*;\s*margin-bottom:\s*0[a-z]*;([^>]*)>([\s\S]*?)<\/p>/g,function(a,b,c,d){return"<p"+b+c+' data-xf-p="1">'+d+"</p>"});a=a.replace(/<div(?=\s|>)/g,function(a){return a+' data-xf-p="1"'});var b;(b=a.match(/^(?:<meta[^>]*>)?<a href=(?:'|")([^'"]*)\/?(?:'|")>\1<\/a>$/))&&
(a=e.trim(b[1]));(b=a.match(/\x3c!--StartFragment--\x3e<a href=(?:'|")([^'"]*)\/?(?:'|")>[^<]+<\/a>\x3c!--EndFragment--\x3e/))&&(a=e.trim(b[1]));a=XF.adjustHtmlForRte(a);a=e.parseHTML(a);var d=function(a){var b,c;for(b=0;b<a.length;b++){var e=a[b];if(e instanceof Element){if(e.hasAttributes()){var f=e.attributes;for(c=f.length-1;0<=c;c--){var h=f[c];"on"!=h.name.toLowerCase().substr(0,2)&&"style"!=h.name.toLowerCase()||e.removeAttribute(h.name)}}d(e.children)}}};d(a);a=e("<div />").html(a).html();
return e.trim(a)});a.events.on("paste.afterCleanup",function(a){return b.normalizePaste(a)});a.events.on("paste.after",function(){var c=a.selection.ranges(0);if(c&&c.getBoundingClientRect){c=c.getBoundingClientRect();var d=a.$wp[0].getBoundingClientRect();(0>c.top||0>c.left||c.bottom>e(k).height()||c.right>e(k).width()||c.bottom>d.bottom)&&setTimeout(function(){b.scrollToCursor()},100)}});d={url:XF.getAutoCompleteUrl()};this.mentioner=new XF.AutoCompleter(e(a.$el),d,a);XF.config.shortcodeToEmoji&&
(d={url:XF.canonicalizeUrl("index.php?misc/find-emoji"),at:":",keepAt:!1,insertMode:"html",displayTemplate:'<div class="contentRow"><div class="contentRow-figure contentRow-figure--emoji">{{{icon}}}</div><div class="contentRow-main contentRow-main--close">{{{text}}}<div class="contentRow-minor contentRow-minor--smaller">{{{desc}}}</div></div></div>',beforeInsert:function(a,b){XF.logRecentEmojiUsage(e(b).find("img.smilie").data("shortname"));return a}},this.emojiCompleter=new XF.AutoCompleter(e(a.$el),
d,a));this.setupUploads();XF.isEditorEnabled()||(d=this.$target.next("input[data-bb-code]"),d.length?a.bbCode.toBbCode(d.val(),!0):a.bbCode.toBbCode(null,!0));XF.EditorHelpers.setupBlurSelectionWatcher(a);this.$target.on("control:enabled",function(){a.edit.on()});this.$target.on("control:disabled",function(){a.edit.off()});this.$target.on("control:enabled",function(){a.edit.on();a.bbCode&&a.bbCode.isBbCodeView()?a.$tb.find(".fr-command[data-cmd=xfBbCode]").removeClass("fr-disabled"):a.toolbar.enable()});
this.$target.on("control:disabled",function(){a.edit.off();a.toolbar.disable();a.$tb.find(" > .fr-command").addClass("fr-disabled")});this.$target.trigger("editor:init",[a,this]);XF.layoutChange()},focus:function(){XF.EditorHelpers.focus(this.ed)},blur:function(){XF.EditorHelpers.blur(this.ed)},normalizePaste:function(b){b=b.replace(/(<(ul|li|p|div)>)\s+/ig,"$1");b=b.replace(/\s+(<\/(ul|li|p|div)>)/ig,"$1");b=b.replace(/<span>&nbsp;<\/span>/ig," ").replace(/(<\/li>)\s+(<li)/ig,"$1$2");var a=this.ed,
d=e.parseHTML(b),c=e("<div />").html(d);c.find("table").each(function(a,b){a=e(b).width("100%");a.wrap('<div class="bbTable"></div>');a.find("[colspan], [rowspan]").removeAttr("colspan rowspan");var c=0;a.find("> tbody > tr").each(function(){var a=e(this).find("> td, > th").length;c=Math.max(c,a)}).each(function(){var a=e(this).find("> td, > th"),b=a.length;if(b<c){var d="<td />";for(b&&"TH"===a[0].tagName&&(d="<th />");b<c;b++)e(this).append(d)}})});c.find("code, del, ins, sub, sup").replaceWith(function(){return this.innerHTML});
var f=!1;c.find("h1").replaceWith(function(){f=!0;return e("<h2>").append(e(this).contents())});var h={H2:f?"H3":"H2",H3:f?"H4":"H3",H4:"H4",H5:"H4",H6:"H4"};c.find("h2, h3, h4, h5, h6").replaceWith(function(){return e("<"+h[this.tagName]+">").append(e(this).contents())});c.find("pre").replaceWith(function(){var a=this.innerHTML;a=a.replace(/\r?\n/g,"<br>").replace(/\t/g,"    ").replace(/  /g,"&nbsp; ").replace(/  /g,"&nbsp; ").replace(/> /g,">&nbsp;").replace(/<br> /g,"<br>&nbsp;");return a+"<br>"});
a.opts.imagePaste||c.find("img[data-fr-image-pasted]").each(function(){var a=e(this);a.attr("src").match(/https?:\/\//i)&&a.removeAttr("data-fr-image-pasted")});c.find("br").each(function(b,d){var f=e(d).parents().not(c);if(f.length&&!f.filter(function(b,c){return a.node.isBlock(c)}).length){b=e([]);var h=!1,g=d,n=f.last();do{for(;g.nextSibling;)f=e(g.nextSibling).clone(),h?b.append(f):b=b.add(f),e(g.nextSibling).remove();g=g.parentNode;if(!g||c.is(g))break;f=e(g).clone().empty();f.html(b);b=f;h=
!0}while(g.parentNode&&!c.is(g.parentNode));e(d).remove();n.after(b);n.after("<br />")}});b="";d=c[0].textContent.replace(/\s/g,"");try{b=(a.win.localStorage.getItem("fr-copied-text")||"").replace(/\s/g,"")}catch(v){}b!==d&&c.find("> p:not([data-xf-p])").each(function(){this.nextSibling&&e(this).after("<p />")});c.find("p").removeAttr("data-xf-p");d=c.contents();b=e("<div />");for(var g=null,l=0;l<d.length;l++){var m=d[l];m.nodeType==Node.ELEMENT_NODE&&a.node.isBlock(m)?(b.append(m),g=null):m.nodeType==
Node.ELEMENT_NODE&&"BR"==m.tagName?(g||b.append("<p />"),g=null):(g||(g=e("<p />"),b.append(g)),g.append(m))}d=b.children();1==d.length&&d.is("p, div")&&(b=d);return b.html()},watchEditorHeight:function(){var b=this.ed,a=this;e(k).onPassive("resize",function(){var c=a.getHeightLimits();b.opts.heightMin=c[0];b.opts.heightMax=c[1];b.size.refresh();XF.layoutChange()});b.events.on("focus",function(){a.scrollToCursorAfterPendingResize()});var d=b.$wp.height(),c=function(){var a=b.$wp.height();d!=a&&(d=
a,XF.layoutChange())};b.events.on("keyup",c);b.events.on("commands.after",c);b.events.on("html.set",c);b.events.on("init",c);b.events.on("initialized",c)},getHeightLimits:function(){var b=this.options.maxHeight,a=this.options.minHeight,d=null,c=null;this.$target.closest(".overlay").length&&(b=.1);b&&(d=e(k).height(),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(d-=250),d=Math.floor(0<b?1>=b?d*b:b:d+b),d=Math.max(d,150));a&&d&&(c=Math.min(a,d),c==d&&--c);return[c,d]},setupUploads:function(){var b=
this,a=this.ed;a.events.on("file.uploaded",function(a){this.popups.hide("file.insert");this.events.focus();return b.handleUploadSuccess(a)});a.events.on("file.error",function(a,d){this.popups.hide("file.insert");b.handleUploadError(a,d);this.events.focus();return!1});this.uploadUrl||(a.events.on("image.beforeUpload",function(){return!1}),a.events.on("file.beforeUpload",function(){return!1}),a.events.on("video.beforeUpload",function(){return!1}));a.events.on("image.error",function(a,d){if(d)return this.popups.hide("image.insert"),
b.handleUploadError(a,d),!1});a.events.on("video.error",function(a,d){if(d)return this.popups.hide("video.insert"),b.handleUploadError(a,d),!1});a.events.on("image.uploaded",function(c){return b.handleUploadSuccess(c,function(){a.image.remove();a.popups.hide("image.insert");a.events.focus();return!1},function(){return!0})});a.events.on("video.uploaded",function(c){return b.handleUploadSuccess(c,function(){a.video.remove();a.popups.hide("video.insert");a.events.focus();return!1},function(){return!0})});
var d=function(a,b){if(b){try{var c=e.parseJSON(b)}catch(m){return}a.hasClass("fr-video")&&(a=a.find("video"),a.attr("data-xf-init","video-init").attr("style","").empty());if(c.attachment){c=c.attachment.attachment_id;b=a[0].attributes;for(var d=/^data-(?!xf-init)/,f=b.length-1;0<=f;f--)d.test(b[f].nodeName)&&a.removeAttr(b[f].nodeName);a.attr("data-attachment","full:"+c)}}};a.events.on("image.inserted video.inserted",d);a.events.on("image.replaced video.replaced",d);a.events.on("image.loaded",function(c){if(a.popups.isVisible("image.edit")){var d=
a.image.get();d&&d[0]==c[0]&&(a.image.exitEdit(!0),d=a.selection.ranges(0),d.setStartAfter(c[0]),d.collapse(!0),c=a.selection.get(),c.removeAllRanges(),c.addRange(d),a.events.focus(),b.scrollToCursor())}});a.events.on("video.loaded",function(c){if(a.popups.isVisible("video.edit")){var d=a.video.get();d&&d[0]==c[0]&&(a.events.trigger("video.hideResizer"),a.popups.hide("video.edit"),d=a.selection.ranges(0),d.setStartAfter(c[0]),d.collapse(!0),c=a.selection.get(),c.removeAllRanges(),c.addRange(d),a.events.focus(),
b.scrollToCursor())}});a.events.on("popups.show.image.edit",function(){var b=a.image.get();b.length&&b.hasClass("smilie")&&(a.image.exitEdit(!0),a.selection.save(),setTimeout(function(){a.selection.restore()},0))})},handleUploadSuccess:function(b,a,d){try{var c=e.parseJSON(b)}catch(f){c={status:"error",errors:[XF.phrase("oops_we_ran_into_some_problems")]}}return c.status&&"error"==c.status?(XF.alert(c.errors[0]),a?a(c):!1):(b=this.getAttachmentManager())&&c.attachment?(b.insertUploadedRow(c.attachment),
d?d(c,b):!1):!1},handleUploadError:function(b,a){try{var d=e.parseJSON(a)}catch(c){d=null}d&&d.errors||(d={status:"error",errors:[XF.phrase("oops_we_ran_into_some_problems")]});XF.alert(d.errors[0])},getAttachmentManager:function(){var b=this.$target.closest("[data-xf-init~=attachment-manager]");return b&&b.length?XF.Element.getHandler(b,"attachment-manager"):null},isBbCodeView:function(){return this.ed.bbCode&&this.ed.bbCode.isBbCodeView?this.ed.bbCode.isBbCodeView():!1},insertContent:function(b,
a){var d=this.ed;this.isBbCodeView()?"undefined"!==typeof a&&d.bbCode.insertBbCode(a):(this.focus(),d.html.insert(b),XF.Element.initialize(d.$el));this.scrollToCursor();this.scrollToCursorAfterPendingResize()},replaceContent:function(b,a){var d=this.ed;this.isBbCodeView()?"undefined"!==typeof a&&d.bbCode.replaceBbCode(a):d.html.set(b)},scrollToCursor:function(){var b=this.ed;if(this.isBbCodeView())b.bbCode.getTextArea().autofocus(),b.$box[0].scrollIntoView(!0);else{this.focus();var a=b.$box,d=b.$wp,
c=b.selection.endElement(),e=c.getBoundingClientRect().bottom,h=!0,g=XF.windowHeight();XF.browser.ios&&(g-=250);if(0>e||e>=g)h=!1;if(d&&h){var l=d[0].getBoundingClientRect();if(e>l.bottom||e<l.top)h=!1}if(!h){e=a[0].getBoundingClientRect();if(0>e.top||e.bottom>=g)XF.browser.ios||a.addClass("is-scrolling-to"),a[0].scrollIntoView(!0),a.removeClass("is-scrolling-to");d?(a=b.position.getBoundingRect().top,a>d.offset().top-b.helpers.scrollTop()+d.height()-50&&d.scrollTop(a+d.scrollTop()-(d.height()+d.offset().top)+
b.helpers.scrollTop()+g/2)):c.scrollIntoView()}}},scrollToCursorAfterPendingResize:function(b){var a=this,d=this.ed,c,f=function(){e(k).off("resize",f);e(k).on("scroll",h);c&&clearTimeout(c);c=setTimeout(g,500)},h=function(){c&&clearTimeout(c);c=setTimeout(g,100)},g=function(){e(k).off("scroll",h);d.core.hasFocus()&&a.scrollToCursor()};e(k).on("resize",f);setTimeout(function(){e(k).off("resize",f)},2E3);b&&(c=setTimeout(g,1E3))},base64ToBytes:function(b,a){a=a||512;b=atob(b);for(var d=[],c=0;c<b.length;c+=
a){for(var e=b.slice(c,c+a),h=Array(e.length),g=0;g<e.length;g++)h[g]=e.charCodeAt(g);e=new Uint8Array(h);d.push(e)}return d},editorSupportsUploads:function(){return-1!==this.ed.opts.imageInsertButtons.indexOf("imageUpload")},imageMatchesBase64Encoding:function(b){return b.attr("src").match(/^data:(image\/([a-z0-9]+));base64,(.*)$/)},replaceBase64ImageWithUpload:function(b){if(!b.hasClass("smilie")){var a;if(a=this.imageMatchesBase64Encoding(b)){var d=a[1];var c=a[2];a=a[3];-1===this.ed.opts.imageAllowedTypes.indexOf(c)?
b[0].remove():this.editorSupportsUploads()?(b=new Blob(this.base64ToBytes(a),{type:d}),1024<b.size&&this.ed.image.upload([b])):b[0].remove()}}},isInitialized:function(){return this.ed?!0:!1}});XF.EditorButtons=XF.create({xfEd:null,buttonClasses:null,toolbars:{},dropdowns:{},removeButtons:null,recalculateNeeded:!0,__construct:function(b,a,d){this.xfEd=b;this.removeButtons=[];a&&(this.toolbars=a);d&&(this.dropdowns=d)},addToolbar:function(b,a){this.toolbars[b]=a;this.recalculateNeeded=!0},adjustToolbar:function(b,
a){var d=this.toolbars[b];return d?(this.toolbars[b]=a(d,b,this),this.recalculateNeeded=!0):!1},adjustToolbars:function(b){for(var a in this.toolbars)this.toolbars.hasOwnProperty(a)&&this.adjustToolbar(a,b)},getToolbar:function(b){return this.getToolbars()[b]},getToolbars:function(){this.recalculateIfNeeded();if(XF.EditorHelpers.isPreviewAvailable(this.xfEd.$target))for(var b in this.toolbars)this.toolbars.hasOwnProperty(b)&&(this.toolbars[b].preview={buttons:["xfPreview"],align:"right"});return this.toolbars},
addDropdown:function(b,a){this.dropdowns[b]=a;this.recalculateNeeded=!0},adjustDropdown:function(b,a){var d=this.dropdowns[b];return d?(this.dropdowns[b]=a(d,b,this),this.recalculateNeeded=!0):!1},adjustDropdowns:function(b){for(var a in this.dropdowns)this.dropdowns.hasOwnProperty(a)&&this.adjustDropdown(a,b)},getDropdown:function(b){return this.getDropdowns()[b]},getDropdowns:function(){this.recalculateIfNeeded();return this.dropdowns},addRemovedButton:function(b){this.removeButtons.push(b);this.recalculateNeeded=
!0},addRemovedButtons:function(b){for(var a=0;a<b.length;a++)this.removeButtons.push(b[a]);this.recalculateNeeded=!0},recalculateIfNeeded:function(){this.recalculateNeeded&&this.recalculate()},recalculate:function(){function b(a,b){if(!a.filter)return[];"string"==typeof b&&d[b]&&(b=d[b]);"string"==typeof b&&(b=b.split("|"));return a.filter(function(a){return!(0<=b.indexOf(a))})}var a=this.removeButtons,d=this.getButtonClasses(),c,e,h,g;for(g=0;g<a.length;g++){var l=a[g];for(c in this.toolbars)if(this.toolbars.hasOwnProperty(c))for(h in this.toolbars[c])this.toolbars[c].hasOwnProperty(h)&&
(this.toolbars[c][h].buttons=b(this.toolbars[c][h].buttons,l));for(e in this.dropdowns)this.dropdowns.hasOwnProperty(e)&&(this.dropdowns[e]=b(this.dropdowns[e],l))}for(e in this.dropdowns)if(this.dropdowns.hasOwnProperty(e)&&!this.dropdowns[e].length)for(c in this.toolbars)if(this.toolbars.hasOwnProperty(c))for(h in this.toolbars[c])this.toolbars[c].hasOwnProperty(h)&&(this.toolbars[c][h].buttons=b(this.toolbars[c][h].buttons,e));this.recalculateNeeded=!1},getButtonClasses:function(){this.buttonClasses||
(this.buttonClasses={_basic:["bold","italic","underline","strikeThrough"],_extended:["textColor","fontFamily","fontSize","xfInlineCode","paragraphFormat"],_link:["insertLink"],_align:["align","alignLeft","alignCenter","alignRight","alignJustify"],_list:["formatOL","formatUL","outdent","indent"],_indent:["outdent","indent"],_smilies:["xfSmilie"],_image:["insertImage","xfInsertGif"],_media:["insertVideo","xfMedia"],_block:"xfQuote xfCode xfSpoiler xfInlineSpoiler insertTable insertHR".split(" ")});
return this.buttonClasses}});XF.EditorHelpers={toolbarSizes:{SM:420,MD:550,LG:800},setupBlurSelectionWatcher:function(b){var a=b.$el,d=!1,c;e(p).on("mousedown keydown",function(a){d&&(b.$el[0]==a.target||e.contains(b.$el[0],a.target)||b.selection.inEditor()&&(c=b.selection.ranges(0)))});b.events.on("blur",function(){b.$box.removeClass("is-focused");c?a.data("xf-ed-blur-sel",c):a.removeData("xf-ed-blur-sel");d=!1;c=null},!0);b.events.on("focus",function(){b.$box.addClass("is-focused");d=!0;c=null;
setTimeout(function(){a.removeData("xf-ed-blur-sel")},0)});b.events.on("commands.before",function(a){(a=FroalaEditor.COMMANDS[a])&&("undefined"==typeof a.focus||a.focus)&&XF.EditorHelpers.restoreMaintainedSelection(b)})},restoreMaintainedSelection:function(b){var a=b.$el.data("xf-ed-blur-sel");b.selection.inEditor()||(a?(b.markers.remove(),b.markers.place(a,!0,0),b.markers.place(a,!1,0)):b.selection.setAtEnd(b.el),b.selection.restore())},focus:function(b){XF.EditorHelpers.restoreMaintainedSelection(b);
b.$tb.addClass("is-focused");b.events.focus()},blur:function(b){b.$el[0].blur();b.$tb.removeClass("is-focused");b.selection.clear()},sync:function(b){b.$oel.val(b.html.get())},wrapSelectionText:function(b,a,d,c){c&&b.selection.save();c=b.$el.find(".fr-marker");c.first().before(XF.htmlspecialchars(a));c.last().after(XF.htmlspecialchars(d));b.selection.restore();b.placeholder.hide()},insertCode:function(b,a,d){switch(a.toLowerCase()){case "":var c="CODE";a="";break;default:c="CODE",a=a.toLowerCase()}d=
d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\t/g,"    ").replace(/\n /g,"\n&nbsp;").replace(/  /g,"&nbsp; ").replace(/  /g," &nbsp;").replace(/\n/g,"</p><p>");d="["+c+(a?"="+a:"")+"]"+d+"[/"+c+"]";d.match(/<\/p>/i)&&(d=("<p>"+d+"</p>").replace(/<p><\/p>/g,"<p><br></p>"));b.html.insert(d)},insertSpoiler:function(b,a){XF.EditorHelpers.wrapSelectionText(b,a?'[SPOILER="'+a+'"]':"[SPOILER]","[/SPOILER]",!0)},isPreviewAvailable:function(b){return!b.data("preview-url")&&
!b.closest("form").data("preview-url")||!1===b.data("preview")?!1:!0},dialogs:{},loadDialog:function(b,a){var d=XF.EditorHelpers.dialogs;d[a]?d[a].show(b):console.error("Unknown dialog '"+a+"'")}};XF.EditorDialog=XF.create({ed:null,overlay:null,dialog:null,cache:!0,__construct:function(b){this.dialog=b},show:function(b){this.ed=b;b.selection.save();XF.loadOverlay(XF.canonicalizeUrl("index.php?editor/dialog&dialog="+this.dialog),{beforeShow:XF.proxy(this,"beforeShow"),afterShow:XF.proxy(this,"afterShow"),
init:XF.proxy(this,"init"),cache:this.cache})},init:function(b){var a=this;b.on("overlay:hidden",function(){a.ed&&a.ed.markers.remove()});this._init(b)},_init:function(b){},beforeShow:function(b){this.overlay=b;this._beforeShow(b)},_beforeShow:function(b){},afterShow:function(b){this._afterShow(b);b.$overlay.find("textarea, input").first().focus()},_afterShow:function(b){}});XF.EditorDialogMedia=XF.extend(XF.EditorDialog,{_beforeShow:function(b){e("#editor_media_url").val("")},_init:function(b){e("#editor_media_form").submit(XF.proxy(this,
"submit"))},submit:function(b){b.preventDefault();var a=this.ed,d=this.overlay;XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/media"),{url:e("#editor_media_url").val()},function(b){b.matchBbCode?(a.selection.restore(),a.html.insert(XF.htmlspecialchars(b.matchBbCode)),d.hide()):b.noMatch?XF.alert(b.noMatch):(a.selection.restore(),d.hide())})}});XF.EditorDialogSpoiler=XF.extend(XF.EditorDialog,{_beforeShow:function(b){e("#editor_spoiler_title").val("")},_init:function(b){e("#editor_spoiler_form").submit(XF.proxy(this,
"submit"))},submit:function(b){b.preventDefault();b=this.ed;var a=this.overlay;b.selection.restore();XF.EditorHelpers.insertSpoiler(b,e("#editor_spoiler_title").val());a.hide()}});XF.EditorDialogCode=XF.extend(XF.EditorDialog,{_beforeShow:function(b){this.ed.$el.blur()},_afterShow:function(b){b=b.$container;var a=b.find(".CodeMirror"),d=this.ed;b.find('[data-xf-init~="code-editor-switcher-container"]').trigger("code-editor:reinit");if(a.length)var c=a[0].CodeMirror;d.selection.isCollapsed()?a="":
(a=d.html.getSelected().replace(/&nbsp;/gmi," ").replace(/\u200B/g,"").replace(/(<\/(p|div|pre|blockquote|h[1-6]|tr|th|ul|ol|li)>)\s*/gi,"$1\n").replace(/<(li|p)><br><\/\1>\s*/gi,"\n").replace(/<br>\s*/gi,"\n"),a=e("<div>").html(e.parseHTML(a)).text().trim());d.selection.save();c?(c.getDoc().setValue(a),c.focus()):b.find(".js-codeEditor").val(a).focus()},_init:function(b){e("#editor_code_form").submit(XF.proxy(this,"submit"))},submit:function(b){b.preventDefault();b=this.ed;var a=this.overlay,d=a.$container.find(".CodeMirror");
if(d.length){d=d[0].CodeMirror;var c=d.getDoc();d.save();c.setValue("");d.setOption("mode","")}d=e("#editor_code_type");c=e("#editor_code_code");b.selection.restore();XF.EditorHelpers.insertCode(b,d.val(),c.val());a.hide();c.val("");d.val("")}});XF.editorStart={started:!1,custom:[],startAll:function(){XF.editorStart.started||(XF.editorStart.setupLanguage(),XF.editorStart.registerOverrides(),XF.editorStart.registerToolbarSizes(),XF.editorStart.registerCommands(),XF.editorStart.registerCustomCommands(),
XF.editorStart.registerEditorDropdowns(),XF.editorStart.registerDialogs(),e(p).trigger("editor:first-start"),XF.editorStart.started=!0)},setupLanguage:function(){var b=e("html").attr("dir");try{var a=e.parseJSON(e(".js-editorLanguage").first().html())||{}}catch(d){console.error(d),a={}}FroalaEditor.LANGUAGE.xf={translation:a,direction:b?b.toLowerCase():"ltr"}},registerOverrides:function(){var b=FroalaEditor.MODULES.helpers;FroalaEditor.MODULES.helpers=function(a){var d=b.apply(this,arguments),c=d.sanitizeURL;
d.sanitizeURL=function(a){return c(a).replace(/["]/g,"%22").replace(/[']/g,"%27")};d.screenSize=function(){function b(b,c){a.$box.data("size",c);return FroalaEditor[FroalaEditor.hasOwnProperty(c)?c:"LG"]}try{var c=a.$box.width(),d=XF.EditorHelpers.toolbarSizes;if(0>=c)for(var e=a.$box[0];e=e.parentNode;)if(c=e.clientWidth,0<c){var m=k.getComputedStyle(e);c-=parseInt(m.paddingLeft,10)+parseInt(m.paddingRight,10);if(0<c)break}return c<d.SM?b(c,"XS"):c<d.MD?b(c,"SM"):c<d.LG?b(c,"MD"):c<d.LG+50?b(c,"LG"):
b(c,"XL")}catch(v){return b(c,"XS")}};return d}},registerToolbarSizes:function(){try{var b=e.parseJSON(e(".js-editorToolbarSizes").first().html())||{}}catch(a){console.error("Toolbar sizes data not valid: ",a);return}XF.EditorHelpers.toolbarSizes=b},commands:{xfQuote:["quote-right",{title:"Quote",icon:"xfQuote",undo:!0,focus:!0,callback:function(){this.selection.save();this.html.wrap(!0,!0,!0,!0);this.selection.restore();var b=this.selection.blocks(),a=[],d=!0,c,f;1==b.length&&e(b[0]).is(".fr-temp-div")&&
(b=[e(this.el).find("p").get(0)]);for(c=0;c<b.length;c++){var h=f=b[c],g=null;for("BLOCKQUOTE"==f.tagName&&(g=f);f.parentNode&&f.parentNode!==this.el;)f=f.parentNode,g||"BLOCKQUOTE"!=f.tagName||(g=f);f={original:h,quote:g,root:f};f.quote&&(d=!1);a.push(f)}this.selection.save();if(d)for(b=e(p.createElement("blockquote")),b.insertBefore(a[0].root),c=0;c<a.length;c++)b.append(a[c].root);else for(c=0;c<a.length;c++)(b=a[c].quote)&&e(b).replaceWith(b.innerHTML);this.html.unwrap();this.selection.restore()}}],
xfCode:["code",{title:"Code",icon:"xfCode",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.loadDialog(this,"code")}}],xfInlineCode:["terminal",{title:"Inline Code",icon:"xfInlineCode",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,"[ICODE]","[/ICODE]",!0)}}],xfMedia:["photo-video",{title:"Media",icon:"xfMedia",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.loadDialog(this,"media")}}],xfSpoiler:["eye-slash",{title:"Spoiler",icon:"xfSpoiler",undo:!0,focus:!0,
callback:function(){XF.EditorHelpers.loadDialog(this,"spoiler")}}],xfInlineSpoiler:["mask",{title:"Inline Spoiler",icon:"xfInlineSpoiler",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,"[ISPOILER]","[/ISPOILER]",!0)}}],xfSmilie:["smile",{title:"Smilies",icon:"xfSmilie",undo:!1,focus:!1,refreshOnCallback:!1,callback:function(){var b=this;setTimeout(function(){b.xfSmilie.showMenu()},0)}}],xfInsertGif:["xfInsertGif",{title:"Insert GIF",icon:"xfInsertGif",undo:!1,focus:!1,
refreshOnCallback:!1,callback:function(){var b=this;setTimeout(function(){b.xfInsertGif.showMenu()},0)}}],xfDraft:["save",{type:"dropdown",title:"Drafts",focus:!0,undo:!1,options:{xfDraftSave:"Save Draft",xfDraftDelete:"Delete Draft"},callback:function(b,a){b=e(this.$el.closest("form"));b.length?(b=XF.Element.getHandler(b,"draft"))?"xfDraftSave"==a?b.triggerSave():"xfDraftDelete"==a&&b.triggerDelete():console.error("No draft handler on parent form"):console.error("No parent form to find draft handler")}}],
xfBbCode:["brackets",{title:"Toggle BB Code",icon:"xfBbCode",undo:!1,focus:!1,forcedRefresh:!0,callback:function(){this.bbCode.toggle()}}],xfPreview:["file-search",{title:"Preview",icon:"xfPreview",undo:!1,focus:!1,forcedRefresh:!0,callback:function(){this.contentPreview.toggle()}}]},registerCommands:function(){var b;FroalaEditor.PLUGINS.xfInsertGif=function(a){function b(){if(k.IntersectionObserver){var a=new IntersectionObserver(f,{root:r[0],rootMargin:"0px 0px 100px 0px"});r.find(".js-gif img:not(.js-observed)").each(function(){e(this).addClass("js-observed");
a.observe(this)});var b=new IntersectionObserver(h,{root:r[0],rootMargin:"0px 0px 50px 0px"});r.find(".js-gifLoadMore").each(function(){b.observe(this)})}else r.onPassive("scroll",g);r.find(".js-gif").on("click",c)}function c(b){b=e(b.currentTarget).find("img");var c=b.parent();if(!c.hasClass("is-loading")){c.addClass("is-loading");var d=b.data("insert"),f=e("<img />").attr("src",d).attr("class","fr-fic fr-dii fr-draggable").attr("alt",b.attr("alt"));b=function(){a.selection.restore();XF.EditorHelpers.focus(a);
a.html.insert(f.prop("outerHTML"));a.selection.save();XF.EditorHelpers.blur(a);q&&q.find(".js-gifCloser").click();c.removeClass("is-loading")};if(f.prop("complete"))b();else f.on("load",b)}}function f(a,b){for(b=0;b<a.length;b++){var c=a[b];var d=e(c.target);if(c.isIntersecting)m(d);else if(c=d,c.data("loaded")){d=c.attr("data-src");var f=c.attr("src");c.attr("src",d);c.attr("data-src",f);c.data("loaded",!1)}}}function h(a,b){for(var c,d,f=0;f<a.length;f++)c=a[f],c.isIntersecting&&(d=e(c.target),
l(d),b.unobserve(c.target))}function g(a){var b=a;a instanceof Event&&(b=e(a.currentTarget));if(b.is(":visible")){var c=b[0].getBoundingClientRect(),d=c.bottom+100;b.children().each(function(){var a=e(this),b=this.getBoundingClientRect();if(!(b.bottom<c.top)){if(b.top>d)return!1;a.find(".js-gif img").each(function(){var a=e(this);this.getBoundingClientRect().top<=d&&m(a)})}})}}function l(a){a.data("loading")||(a.data("loading",!0),XF.ajax("GET",a.data("href"),function(c){c.html&&XF.setupHtmlInsert(c.html,
function(c){(c.is(".js-gifContainer")?e(c.html()):e(c.find(".js-gifContainer").html())).insertAfter(a);a.remove();b()})}))}function m(a){if(!a.data("loaded")){var b=a.attr("data-src"),c=a.attr("src");a.attr("src",b);a.attr("data-src",c);a.data("loaded",!0)}}function v(){var a=e(this),c=q.find(".js-gifFullRow"),d=q.find(".js-gifSearchRow");clearTimeout(w);w=setTimeout(function(){var e=a.val();if(!e||2>e.length)d.hide(),c.show(),g(c);else{var f=XF.canonicalizeUrl("index.php?editor/insert-gif/search");
XF.ajax("GET",f,{q:e},function(a){a.html&&XF.setupHtmlInsert(a.html,function(a){c.hide();d.html(a);d.show();r.scrollTop(0);b()})})}},300)}var n=!1,t=!1,q,r,p=0,w;return{showMenu:function(){a.selection.save();XF.EditorHelpers.blur(a);var c=e(a.$tb.find('.fr-command[data-cmd="xfInsertGif"]')).first();if(!n){n=!0;var d=e.trim(e(".js-xfEditorMenu").first().html());q=e(e.parseHTML(Mustache.render(d,{href:XF.canonicalizeUrl("index.php?editor/insert-gif")})));q.addClass("menu--gif");q.insertAfter(c);c.data("xf-click",
"menu");var f=XF.Event.getElementHandler(c,"menu","click");q.on("menu:complete",function(){r=q.find(".menu-scroller");t||(t=!0,b(),q.find(".js-gifSearch").on("input",v),q.find(".js-gifCloser").on("click",function(){XF.EditorHelpers.focus(a)}),a.events.on("commands.mousedown",function(a){"xfInsertGif"!=a.data("cmd")&&f.close()}),q.on("menu:closed",function(){p=r.scrollTop()}));r.scrollTop(p);k.IntersectionObserver||g(r)});q.on("menu:closed",function(){setTimeout(function(){a.markers.remove()},50)})}(c=
c.data("xfClickHandlers"))&&c.menu&&c.menu.toggle()}}};FroalaEditor.PLUGINS.xfSmilie=function(a){function b(b){var c=e(b.currentTarget);b=c.html();if(!e(b).hasClass("smilie--lazyLoad")){a.selection.restore();XF.EditorHelpers.focus(a);a.html.insert(b);a.selection.save();XF.EditorHelpers.blur(a);if(n){var d=n.find(".js-emojiInsertedRow");d.find(".js-emojiInsert").html(b);d.addClassTransitioned("is-active");clearTimeout(r);r=setTimeout(function(){d.removeClassTransitioned("is-active")},1500)}clearTimeout(u);
u=setTimeout(function(){XF.logRecentEmojiUsage(c.data("shortname"))},1500)}}function c(a,b){for(var c,d,f=0;f<a.length;f++)c=a[f],c.isIntersecting&&(d=e(c.target),h(d),b.unobserve(c.target))}function f(a,b){var c=a;a instanceof Event&&(c=e(a.currentTarget));if(b||c.is(":visible")){var d=c[0].getBoundingClientRect(),f=d.bottom+100;c.children().each(function(){var a=e(this),b=this.getBoundingClientRect();if(!(b.bottom<d.top)){if(b.top>f)return!1;a.find("span.smilie--lazyLoad").each(function(){var a=
e(this);this.getBoundingClientRect().top<=f&&h(a)})}})}}function h(a){var b=e("<img />").attr({"class":a.attr("class").replace(/(\s|^)smilie--lazyLoad(\s|$)/," "),alt:a.attr("data-alt"),title:a.attr("title"),src:a.attr("data-src"),"data-shortname":a.attr("data-shortname")}),c=function(){var c=function(){a.replaceWith(b)};k.requestAnimationFrame?k.requestAnimationFrame(c):c()};if(b.prop("complete"))c();else b.on("load",c)}function g(){var a=e(this),c=n.find(".js-emojiFullList"),d=n.find(".js-emojiSearchResults");
clearTimeout(w);w=setTimeout(function(){var e=a.val();if(!e||2>e.length)d.hide(),c.show(),f(c);else{var g=XF.canonicalizeUrl("index.php?editor/smilies-emoji/search");XF.ajax("GET",g,{q:e},function(a){a.html&&XF.setupHtmlInsert(a.html,function(a){a.find(".js-emoji").on("click",b);c.hide();d.replaceWith(a)})})}},300)}function l(){var a=XF.getRecentEmojiUsage(),c=t.find(".js-recentHeader"),d=t.find(".js-recentBlock"),g=d.find(".js-recentList"),n=t.find(".js-emojiList");if(a){var h=g.clone(),m=[];h.empty();
for(var v in a){var q=a[v],l;n.each(function(){l=e(this).find('.js-emoji[data-shortname="'+q+'"]').closest("li").clone();if(l.length)return l.find(".js-emoji").on("click",b),m.push(l),!1})}for(v in m)m[v].appendTo(h);g.replaceWith(h);d.hasClass("is-hidden")&&(d.hide(),d.removeClass("is-hidden"),c.removeClass("is-hidden"),d.xfFadeDown(XF.config.speed.fast));f(h,!0)}}var m=!1,v=!1,n,t,q=0,r,u,w;return{showMenu:function(){a.selection.save();XF.EditorHelpers.blur(a);var d=e(a.$tb.find('.fr-command[data-cmd="xfSmilie"]')).first();
if(!m){m=!0;var h=e.trim(e(".js-xfEditorMenu").first().html());n=e(e.parseHTML(Mustache.render(h,{href:XF.canonicalizeUrl("index.php?editor/smilies-emoji")})));n.addClass("menu--emoji");n.insertAfter(d);d.data("xf-click","menu");var r=XF.Event.getElementHandler(d,"menu","click");n.on("menu:complete",function(){t=n.find(".menu-scroller");if(!v){v=!0;if(k.IntersectionObserver){var d=new IntersectionObserver(c,{root:t[0],rootMargin:"0px 0px 100px 0px"});t.find("span.smilie--lazyLoad").each(function(){d.observe(this)})}else t.onPassive("scroll",
f);t.find(".js-emoji").on("click",b);n.find(".js-emojiSearch").on("input",g);n.find(".js-emojiCloser").on("click",function(){XF.EditorHelpers.focus(a)});e(p).on("recent-emoji:logged",l);a.events.on("commands.mousedown",function(a){"xfSmilie"!=a.data("cmd")&&r.close()});n.on("menu:closed",function(){q=t.scrollTop()})}t.scrollTop(q);k.IntersectionObserver||f(t)});n.on("menu:closed",function(){setTimeout(function(){a.markers.remove()},50)})}(d=d.data("xfClickHandlers"))&&d.menu&&d.menu.toggle()}}};e.extend(FroalaEditor.DEFAULTS,
{xfBbCodeAttachmentContextInput:"attachment_hash_combined"});FroalaEditor.PLUGINS.bbCode=function(a){function b(){return a.$tb.find(".fr-command[data-cmd=xfBbCode]")}function c(){var b=a.$oel,c=b.data("xfBbCodeBox");if(!c){var d=parseInt(a.$wp.css("border-bottom-width"),10)+parseInt(a.$wp.css("border-top-width"),10);c=e('<textarea class="input" style="display: none" />');c.attr("aria-label",XF.htmlspecialchars(XF.phrase("rich_text_box")));c.css({minHeight:a.opts.heightMin?a.opts.heightMin+d+"px":
null,maxHeight:a.opts.heightMax?a.opts.heightMax+"px":null,height:a.opts.height?a.opts.height+d+"px":null,padding:a.$el.css("padding")});c.attr("name",b.data("original-name"));b.data("xfBbCodeBox",c);a.$wp.after(c[0]);c.on("focus blur",function(b){switch(b.type){case "focus":a.$box.addClass("is-focused");break;case "blur":a.$box.removeClass("is-focused")}});XF.Element.applyHandler(c,"textarea-handler");XF.Element.applyHandler(c,"user-mentioner");XF.Element.applyHandler(c,"emoji-completer");XF.isElementWithinDraftForm(c)&&
XF.Element.applyHandler(c,"draft-trigger")}return c}function f(b){return a.$tb.find("> .fr-btn-grp .fr-command, > .fr-more-toolbar .fr-command").not(b).not('[data-cmd^="more"]').not("[data-cmd=xfPreview]")}function h(d,e){var g=c(),h=function(c,d){l=!0;a.undo.saveStep();a.$el.blur();var e=b();f(e).addClass("fr-disabled");e.addClass("fr-active");a.$wp.css("display","none");a.$oel.attr("disabled","disabled");g.val(c).css("display","").prop("disabled",!1).trigger("autosize");d||g.autofocus();XF.setIsEditorEnabled(!1)};
"string"==typeof d?h(d,e):XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-bb-code"),{html:a.html.get()},function(a){h(a.bbCode,e)})}function g(d){var g=c(),h=function(c){l=!1;var d=b();f(d).removeClass("fr-disabled");d.removeClass("fr-active");a.$oel.removeAttr("disabled");a.html.set(c);g.css("display","none").prop("disabled",!0);a.$wp.css("display","");a.events.focus();a.undo.saveStep();a.size.refresh();XF.setIsEditorEnabled(!0);XF.layoutChange()};if("string"==typeof d)h(d);else{d={bb_code:g.val()};
var m=a.$el.closest("form");m.length&&m[0][a.opts.xfBbCodeAttachmentContextInput]&&(d.attachment_hash_combined=e(m[0][a.opts.xfBbCodeAttachmentContextInput]).val());XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-html"),d,function(a){h(a.editorHtml)})}}var l=!1;return{_init:function(){a.events.on("buttons.refresh",function(){return!l})},getBbCodeBox:c,toBbCode:h,isBbCodeView:function(){return l},getTextArea:function(){return l?c():null},insertBbCode:function(a){if(l){var b=c();XF.insertIntoTextBox(b,
a)}},replaceBbCode:function(a){if(l){var b=c();XF.replaceIntoTextBox(b,a)}},toHtml:g,toggle:function(){l?g():h()},getToggleableButtons:function(){return f(b())}}};FroalaEditor.PLUGINS.contentPreview=function(a){function b(){return a.$tb.find(".fr-command[data-cmd=xfPreview]")}function c(){var b=a.$oel,c=b.data("xfPreviewBox");if(!c){var d=e(a.$el[0]).css(["padding-top","padding-right","padding-bottom","padding-left"]);d.minHeight=a.opts.heightMin?a.opts.heightMin+"px":null;c=e('<div class="xfPreview" style="display:none" />');
c.css(d);b.data("xfPreviewBox",c);a.$wp.after(c[0])}return c}function f(b){return a.$tb.find("> .fr-btn-grp .fr-command").not(b)}function h(d){var g=c(),h=function(c){k=!0;a.undo.saveStep();a.$el.blur();a.$tb.find('.fr-command.fr-open[data-cmd^="more"]').each(function(){a.commands.exec(e(this).attr("data-cmd"))});var d=b();f(d).addClass("fr-disabled fr-invisible");d.addClass("fr-active");a.$tb.find(".fr-btn-grp").addClass("rte-tab--inactive").filter(".rte-tab--preview").removeClass("rte-tab--inactive");
a.$box.addClass("is-preview");a.bbCode.isBbCodeView()?a.bbCode.getBbCodeBox().css("display","none"):a.$wp.css("display","none");g.html(c.find(".bbWrapper")).css("display","")};if("string"==typeof d)h(e(e.parseHTML(d)));else{a.events.trigger("form.submit");var n=a.$oel.closest("form");d=a.$oel.data("preview-url")?a.$oel.data("preview-url"):n.data("preview-url");n=XF.getDefaultFormData(n);XF.ajax("POST",XF.canonicalizeUrl(d),n,function(a){XF.setupHtmlInsert(a.html,function(a){XF.activate(a);h(a)})})}}
function g(d){var e=c(),g=b(),h=a.bbCode.isBbCodeView();k=!1;f(g).removeClass("fr-disabled fr-invisible");g.removeClass("fr-active");h&&a.bbCode.getToggleableButtons().addClass("fr-disabled");a.$tb.find(".fr-btn-grp").removeClass("rte-tab--inactive").filter(".rte-tab--preview").addClass("rte-tab--inactive");a.$oel.removeAttr("disabled");e.css("display","none");a.$box.removeClass("is-preview");h?a.bbCode.getBbCodeBox().css("display",""):a.$wp.css("display","");d||a.events.focus();XF.layoutChange()}
function l(){var b=e(a.$oel);XF.EditorHelpers.isPreviewAvailable(b)&&(k?g():(XF.EditorHelpers.sync(a),(a.bbCode&&a.bbCode.isBbCodeView()?a.bbCode.getBbCodeBox().val():b.val())&&h()))}function m(){var b=a.$tb.find(".fr-btn-grp");XF.EditorHelpers.isPreviewAvailable(e(a.$oel))?(b.slice(b.length-1).addClass("rte-tab--inactive rte-tab--preview"),b.slice(b.length-2,b.length-1).addClass("rte-tab--beforePreview")):b.slice(b.length-1).addClass("rte-tab--beforePreview")}var k=!1;return{_init:function(){a.events.on("buttons.refresh",
function(){return!k});m();a.events.on("codeView.toggle",function(){m()});a.$tb.on("click",function(a){k&&(e(a.target).closest(".rte-tab--preview").length||l())});e(a.$tb.closest("form")).on("preview:hide",function(){g(!0)})},toPreview:h,isPreview:function(){return k},toHtml:g,toggle:l}};for(b in this.commands)this.commands.hasOwnProperty(b)&&(FroalaEditor.DefineIcon(b,{NAME:this.commands[b][0]}),FroalaEditor.RegisterCommand(b,this.commands[b][1]))},registerCustomCommands:function(){try{var b=e.parseJSON(e(".js-editorCustom").first().html())||
{}}catch(d){console.error(d),b={}}for(var a in b)b.hasOwnProperty(a)&&function(a,b){var c="xfCustom_"+a,d=a.toUpperCase();a={};"fa"==b.type?a=(a=b.value.match(/^fa([slrb]) fa-(.+)$/))?{FA5NAME:a[2],template:"font_awesome_5"+("s"===a[1]?"":a[1])}:{NAME:b.value}:"svg"==b.type?a={template:"svg",PATH:b.value}:"image"==b.type&&(a={template:"image",SRC:'"'+XF.canonicalizeUrl(b.value)+'"',ALT:'"'+b.title+'"'});var e={title:b.title,icon:c,undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,
"yes"==b.option?"["+d+"=]":"["+d+"]","[/"+d+"]",!0)}};FroalaEditor.DefineIcon(c,a);FroalaEditor.RegisterCommand(c,e);XF.editorStart.custom.push(c)}(a,b[a]);FroalaEditor.DefineIcon("xfInsertGif",{template:"svg",PATH:"M11.5 9H13v6h-1.5zM9 9H6c-.6 0-1 .5-1 1v4c0 .5.4 1 1 1h3c.6 0 1-.5 1-1v-2H8.5v1.5h-2v-3H10V10c0-.5-.4-1-1-1zm10 1.5V9h-4.5v6H16v-2h2v-1.5h-2v-1z"});FroalaEditor.DefineIcon("textColor",{NAME:"palette"});FroalaEditor.DefineIcon("fontFamily",{NAME:"font"});FroalaEditor.DefineIcon("fontSize",
{NAME:"text-size"})},registerEditorDropdowns:function(){try{var b=e.parseJSON(e(".js-editorDropdowns").first().html())||{}}catch(d){console.error("Editor dropdowns data not valid: ",d),b={}}for(var a in b)b.hasOwnProperty(a)&&function(a,b){b.icon=b.icon.substr(3);FroalaEditor.DefineIcon(a,{NAME:b.icon});FroalaEditor.RegisterCommand(a,{type:"dropdown",title:b.title,icon:a,undo:!1,focus:!1,html:function(){var c='<ul class="fr-dropdown-list">',d=b.buttons,e,k;(e=XF.getEditorInContainer(this.$oel))&&
e.buttonManager&&(d=e.buttonManager.getDropdown(a));for(var m in d)e=d[m],(k=FroalaEditor.COMMANDS[e])&&(c+='<li><a class="fr-command" data-cmd="'+e+'">'+this.icon.create(k.icon||e)+"&nbsp;&nbsp;"+this.language.translate(k.title)+"</a></li>");return c+"</ul>"}})}(a,b[a])},registerDialogs:function(){XF.EditorHelpers.dialogs.media=new XF.EditorDialogMedia("media");XF.EditorHelpers.dialogs.spoiler=new XF.EditorDialogSpoiler("spoiler");XF.EditorHelpers.dialogs.code=new XF.EditorDialogCode("code")}};e(p).one("editor:start",
XF.editorStart.startAll);XF.EditorPlaceholderClick=XF.Event.newHandler({eventNameSpace:"XFEditorPlaceholderClick",options:{},edInitialized:!1,init:function(){},click:function(b){b=this.$target;var a=this;b.find(".editorPlaceholder-editor").removeClass("is-hidden");b.find(".editorPlaceholder-placeholder").addClass("is-hidden");b=XF.getEditorInContainer(b);b instanceof XF.Editor?this.edInitialized||b.startInit({beforeInit:function(){a.edInitialized=!0},afterInit:function(a,b){b.events.focus(!0);XF.isIOS()&&
(a.scrollToCursor(),a.scrollToCursorAfterPendingResize());b.opts.tooltips&&setTimeout(function(){b.tooltip.hide()},30)}}):(displayEditor(),b instanceof e&&b.focus())}});XF.Event.register("click","editor-placeholder","XF.EditorPlaceholderClick");XF.Element.register("editor","XF.Editor")}(jQuery,window,document);
