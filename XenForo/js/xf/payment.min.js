var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,f,e){c instanceof String&&(c=String(c));for(var g=c.length,a=0;a<g;a++){var b=c[a];if(f.call(e,b,a,c))return{i:a,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,f,e){c!=Array.prototype&&c!=Object.prototype&&(c[f]=e.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,f,e,g){if(f){e=$jscomp.global;c=c.split(".");for(g=0;g<c.length-1;g++){var a=c[g];a in e||(e[a]={});e=e[a]}c=c[c.length-1];g=e[c];f=f(g);f!=g&&null!=f&&$jscomp.defineProperty(e,c,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,e){return $jscomp.findInternal(this,c,e).v}},"es6","es3");
!function(c,f,e,g){XF.PaymentProviderContainer=XF.Element.newHandler({options:{},init:function(){if(this.$target.is("form"))this.$target.on("ajax-submit:response",XF.proxy(this,"submitResponse"));else console.error("%o is not a form",this.$target[0])},submitResponse:function(a,b){if(b.providerHtml){a.preventDefault();var c=this.$target.parent().find(".js-paymentProviderReply-"+b.purchasableTypeId+b.purchasableId);XF.setupHtmlInsert(b.providerHtml,function(a,b){c.html(a)})}}});XF.BraintreePaymentForm=
XF.Element.newHandler({options:{clientToken:null,formStyles:".js-formStyles"},xhr:null,init:function(){this.$target.on("submit",XF.proxy(this,"submit"));XF.loadScripts(["https://js.braintreegateway.com/web/3.19.0/js/client.min.js","https://js.braintreegateway.com/web/3.19.0/js/hosted-fields.min.js"],XF.proxy(this,"postInit"));var a=this.$target.closest(".overlay-container").data("overlay");if(a)a.on("overlay:hidden",function(){a.destroy()})},postInit:function(){if(this.options.clientToken){var a=
this,b=this.$target.find(this.options.formStyles)||{},d=b?c.parseJSON(b.first().html()):{};braintree.client.create({authorization:this.options.clientToken},function(b,k){b?XF.alert(b.message):braintree.hostedFields.create({client:k,styles:d,fields:{number:{selector:"#card-number",placeholder:"1234 1234 1234 1234"},expirationDate:{selector:"#card-expiry",placeholder:"MM / YY"},cvv:{selector:"#card-cvv",placeholder:"CVC"}}},function(b,d){if(b)XF.alert(b.message);else{b=d._fields;for(var h in b)b.hasOwnProperty(h)&&
c(b[h].containerElement).removeClass("is-disabled");d.on("cardTypeChange",function(a){a=1===a.cards.length?a.cards[0].type:"unknown";var b={visa:"fa-cc-visa","master-card":"fa-cc-mastercard","american-express":"fa-cc-amex",discover:"fa-cc-discover","diners-club":"fa-cc-diners",jcb:"fa-cc-jcb",unionpay:"fa-credit-card-alt",maestro:"fa-credit-card-alt",unknown:"fa-credit-card-alt"};if(a){var d=c("#brand-icon"),h="fa-credit-card-alt";a in b&&(h=b[a]);d[0].className="";d.addClass("fa");d.addClass("fa-lg");
d.addClass(h)}});a.$target.on("submit",function(b){b.preventDefault();d.tokenize(function(b,c){b?(c=b.message,(b=b.details.invalidFieldKeys)&&(c+=" ("+b.join(", ")+")"),XF.alert(c)):a.response(c)})})}})})}else console.error("Form must contain a data-client-token attribute.")},submit:function(a){a.preventDefault();return!1},response:function(a){this.xhr&&this.xhr.abort();this.xhr=XF.ajax("post",this.$target.attr("action"),a,XF.proxy(this,"complete"),{skipDefaultSuccess:!0})},complete:function(a){this.xhr=
null;a.redirect&&XF.redirect(a.redirect)}});XF.BraintreeApplePayForm=XF.Element.newHandler({options:{clientToken:null,currencyCode:"",boardTitle:"",title:"",amount:""},xhr:null,init:function(){XF.loadScripts(["https://js.braintreegateway.com/web/3.19.0/js/client.min.js","https://js.braintreegateway.com/web/3.19.0/js/apple-pay.min.js"],XF.proxy(this,"postInit"))},postInit:function(){if(this.options.clientToken){var a=this,b=!1;f.ApplePaySession&&ApplePaySession.canMakePayments()&&(b=!0);b&&braintree.client.create({authorization:this.options.clientToken},
function(b,c){b?XF.alert(b.message):braintree.applePay.create({client:c},function(b,c){b?XF.alert(b.message):ApplePaySession.canMakePaymentsWithActiveCard(c.merchantIdentifier).then(function(b){b?(a.$target.removeClass("u-hidden"),a.$target.find(".js-applePayButton").on("click",function(){var b=c.createPaymentRequest({total:{label:a.options.title,amount:a.options.amount}}),d=new ApplePaySession(2,b);d.onvalidatemerchant=function(b){c.performValidation({validationURL:b.validationURL,displayName:a.options.boardTitle},
function(a,b){a?(XF.alert(a.message),d.abort()):d.completeMerchantValidation(b)})};d.onpaymentauthorized=function(b){c.tokenize({token:b.payment.token},function(b,c){b?(XF.alert(b.message),d.completePayment(ApplePaySession.STATUS_FAILURE)):(d.completePayment(ApplePaySession.STATUS_SUCCESS),a.response(c))})};d.begin()})):console.warn("No Apple Pay card available")})})})}else console.error("Form must contain a data-client-token attribute.")},response:function(a){this.xhr&&this.xhr.abort();this.xhr=
XF.ajax("post",this.$target.attr("action"),a,XF.proxy(this,"complete"),{skipDefaultSuccess:!0})},complete:function(a){this.xhr=null;a.redirect&&XF.redirect(a.redirect)}});XF.BraintreePayPalForm=XF.Element.newHandler({options:{clientToken:null,paypalButton:"#paypal-button",testPayments:!1},xhr:null,init:function(){XF.loadScripts(["https://www.paypalobjects.com/api/checkout.js","https://js.braintreegateway.com/web/3.19.0/js/client.min.js","https://js.braintreegateway.com/web/3.19.0/js/paypal-checkout.min.js",
"https://js.braintreegateway.com/web/3.19.0/js/data-collector.min.js"],XF.proxy(this,"postInit"))},postInit:function(){if(this.options.clientToken){var a=this;braintree.client.create({authorization:this.options.clientToken},function(b,c){b?XF.alert(b.message):braintree.paypalCheckout.create({client:c},function(b,c){b?XF.alert(b.message):paypal.Button.render({env:a.options.testPayments?"sandbox":"production",payment:function(){return c.createPayment({flow:"vault",enableShippingAddress:!1})},onAuthorize:function(b,
d){return c.tokenizePayment(b).then(function(b){a.response(b)})},onCancel:function(a){console.log("checkout.js payment cancelled",JSON.stringify(a,0,2))},onError:function(a){XF.alert(a.message)}},a.options.paypalButton)})})}else console.error("Form must contain a data-client-token attribute.")},response:function(a){this.xhr&&this.xhr.abort();this.xhr=XF.ajax("post",this.$target.attr("action"),a,XF.proxy(this,"complete"),{skipDefaultSuccess:!0})},complete:function(a){this.xhr=null;a.redirect&&XF.redirect(a.redirect)}});
XF.StripePaymentForm=XF.Element.newHandler({options:{publishableKey:null,formStyles:".js-formStyles",recurring:null,piSecret:null,prEnabled:null,prCountry:null,prCost:null,prCurrency:null,prLabel:null,styleType:"dark"},stripe:null,elements:null,elementsCache:{},paymentRequest:null,stripeJs:"https://js.stripe.com/v3/",processing:null,init:function(){this.$target.on("submit",XF.proxy(this,"submit"));XF.loadedScripts.hasOwnProperty(this.stripeJs)?this.postInit():XF.loadScript(this.stripeJs,XF.proxy(this,
"postInit"))},postInit:function(){if(this.options.publishableKey){this.stripe=Stripe(this.options.publishableKey);this.elements=this.stripe.elements();this.options.prEnabled&&(this.paymentRequest=this.stripe.paymentRequest({country:this.options.prCountry,currency:this.options.prCurrency.toLowerCase(),total:{label:this.options.prLabel,amount:this.options.prCost},requestPayerName:!0,requestPayerEmail:!0}));this.initElements();var a=this.$target.closest(".overlay-container").data("overlay");if(a)a.on("overlay:hidden",
function(){a.destroy();c("iframe").each(function(){var a=c(this);a.attr("name")&&0<=a.attr("name").toLowerCase().indexOf("stripe")&&a.remove()})})}else console.error("Form must contain a data-publishable-key attribute.")},initElements:function(){var a=this,b=this.elements,d=this.paymentRequest,h=this.$target.find(this.options.formStyles)||{};h=h?c.parseJSON(h.first().html()):{};if(d){var e=b.create("paymentRequestButton",{paymentRequest:d,style:{paymentRequestButton:{theme:"light"===this.options.styleType?
"light-outline":"dark"}}});d.canMakePayment().then(function(b){b?(e.mount("#payment-request-button"),a.$target.find(".js-pr-remove").show()):a.$target.find(".js-pr-remove").remove()});d.on("paymentmethod",XF.proxy(a,"onPrPaymentMethod"))}b=b.create("card",{style:h});b.mount("#card-element");this.elementsCache.card=b},onPrPaymentMethod:function(a){var b=this,c=a.paymentMethod.id;this.options.recurring?(a.complete("success"),this.triggerSubscription(c)):this.stripe.confirmCardPayment(this.options.piSecret,
{payment_method:c},{handleActions:!1}).then(function(c){c.error?a.complete("fail"):(a.complete("success"),b.handleCardPayment())})},submit:function(a){a.preventDefault();if(this.processing)return!1;this.startProcessing();a=this.elementsCache.card;var b=this.options.piSecret;this.options.recurring?this.setupSubscriptionFromCard(a):b&&b.length?this.handleCardPayment(a):this.handleError("Developer error: not recurring and no payment intent found")},setupSubscriptionFromCard:function(a){var b=this;this.stripe.createPaymentMethod({type:"card",
card:a}).then(function(a){a.error?b.handleError(a.error):b.triggerSubscription(a.paymentMethod.id)})},triggerSubscription:function(a){this.$target.find("input[name=payment_method_id]").val(a);this.submitForm(XF.proxy(this,"handleSubscriptionSubmit"))},handleSubscriptionSubmit:function(a){var b=this.stripe,c=this,e=this.$target.find("input[name=payment_method_id]").val();a.paymentFailed?(this.stopProcessing(),b.confirmCardPayment(a.piSecret,{payment_method:e}).then(function(a){a.error?c.handleError(a.error):
"succeeded"===a.paymentIntent.status&&c.submitForm(XF.proxy(c,"handleSubscriptionSubmit"))})):this.complete(a)},handleCardPayment:function(a){var b=this,c=this.stripe,e=this.options.piSecret,f;a&&(f={payment_method:{card:a}});c.confirmCardPayment(e,f).then(function(a){a.error?b.handleError(a.error):b.response()})},handleError:function(a){var b=c("#card-errors-container"),d=b.find("#card-errors");d.text(a.message);d.removeClass("u-hidden");b.removeClass("u-hidden");this.stopProcessing()},startProcessing:function(){if(!this.processing){this.processing=
!0;var a=c("#card-errors-container"),b=a.find("#card-errors");a.addClass("u-hidden");b.addClass("u-hidden");b.text("");this.$target.find("[type=submit]").addClass("is-disabled").prop("disabled",!0);XF.ActionIndicator.show()}},stopProcessing:function(){this.processing&&(this.processing=!1,this.$target.find("[type=submit]").removeClass("is-disabled").prop("disabled",!1),XF.ActionIndicator.hide())},submitForm:function(a){this.startProcessing();var b=this.$target,c=XF.getDefaultFormData(b),e=this;XF.ajax("post",
b.attr("action"),c,a,{skipDefaultSuccess:!0}).always(function(){e.stopProcessing()})},response:function(){this.submitForm(XF.proxy(this,"complete"))},complete:function(a){a.redirect&&XF.redirect(a.redirect)}});XF.Element.register("payment-provider-container","XF.PaymentProviderContainer");XF.Element.register("braintree-payment-form","XF.BraintreePaymentForm");XF.Element.register("braintree-apple-pay-form","XF.BraintreeApplePayForm");XF.Element.register("braintree-paypal-form","XF.BraintreePayPalForm");
XF.Element.register("stripe-payment-form","XF.StripePaymentForm")}(jQuery,window,document);
